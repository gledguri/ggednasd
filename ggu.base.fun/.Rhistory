View(ident)
df1 <- read_excel("Library/CloudStorage/OneDrive-Havforskningsinstituttet/IMR/Data/Stockele data/Entire data.xlsx",
sheet = "Sheet1"); df1$tax_id <- c(1:nrow(df1)); df1$m <- "Ost_5_order"
df2 <- read_excel("Library/CloudStorage/OneDrive-Havforskningsinstituttet/IMR/Data/Stockele data/Entire data.xlsx",
sheet = "Sheet2"); df2$tax_id <- c(1:nrow(df2));df2$m <- "Amount_DNA"
df3 <- read_excel("Library/CloudStorage/OneDrive-Havforskningsinstituttet/IMR/Data/Stockele data/Entire data.xlsx",
sheet = "Sheet3"); df3$tax_id <- c(1:nrow(df3));df3$m <- "Emu_2_order_&_Ost_2_high_order"
df4 <- read_excel("Library/CloudStorage/OneDrive-Havforskningsinstituttet/IMR/Data/Stockele data/Entire data.xlsx",
sheet = "Sheet4"); df4$tax_id <- c(1:nrow(df4));df4$m <- "Amp_eff_R";df4$seq_name <- paste0(">",df4$seq_name)
df5 <- read_excel("Library/CloudStorage/OneDrive-Havforskningsinstituttet/IMR/Data/Stockele data/Entire data.xlsx",
sheet = "Sheet5"); df5$tax_id <- c(1:nrow(df5));df5$m <- "Amp_eff_M"
seq_name<- c(df1$seq_name,df2$seq_name,df3$seq_name,df4$seq_name,df5$seq_name)
seq<- c(df1$seq,df2$seq,df3$seq,df4$seq,df5$seq)
m<- c(df1$m,df2$m,df3$m,df4$m,df5$m)
fast <- as.data.frame(cbind(seq_name,seq,m));rm(seq,seq_name,m)
fast$taxid <- c(1:nrow(fast))
#Change the name of the sequences for those who have identical nucleotide sequences
fast$seq_name[grep(">1.00_Silver_perch_Bardiella_chrysoura",
fast$seq_name)] <- ">1.00_Silver_perch_Bardiella_chrysoura"
fast$seq_name[grep(">1.00_Southern_kingfish_Menticirrhus_americanus",
fast$seq_name)] <- ">1.00_Southern_kingfish_Menticirrhus_americanus"
fast$seq_name[grep(">1.00_Northern_sennet_Sphyraena_borealis",
fast$seq_name)] <- ">1.00_Northern_sennet_Sphyraena_borealis"
fast$seq_name[grep(">1.00_Cutlassfis",
fast$seq_name)] <- ">1.00_Cutlassfish98_Trichiurus_sp98"
fast$seq_name[grep(">1.00_Crested_blenny_Hypleurochilus_",
fast$seq_name)] <- ">1.00_Crested_blenny_Hypleurochilus_germinatus"
fast$seq_name[grep(">3.01_Dog_Canis_lupus_",
fast$seq_name)] <- ">3.01_Dog_Canis_lupus"
fast$seq_name[grep(">3.01_Cat_Felis_catus",
fast$seq_name)] <- ">3.01_Cat_Felis_catus"
#Create a dataframe that looks at duplicated sequence names or duplicated nucleotide sequences
ident <- as.data.frame(cbind(duplicated(fast$seq_name),duplicated(fast$seq)))
ident$prod <- ident$V1+ident$V2; ident$prod[ident$prod==2] <- 0
ident <- as.data.frame(cbind(fast$seq_name[ident$prod>0],
fast$m[ident$prod>0],
ident$V1[ident$prod>0],
ident$V2[ident$prod>0]))
df1 <- read_excel("Library/CloudStorage/OneDrive-Havforskningsinstituttet/IMR/Data/Stockele data/Entire data.xlsx",
sheet = "Sheet1"); df1$tax_id <- c(1:nrow(df1)); df1$m <- "Ost_5_order"
df2 <- read_excel("Library/CloudStorage/OneDrive-Havforskningsinstituttet/IMR/Data/Stockele data/Entire data.xlsx",
sheet = "Sheet2"); df2$tax_id <- c(1:nrow(df2));df2$m <- "Amount_DNA"
df3 <- read_excel("Library/CloudStorage/OneDrive-Havforskningsinstituttet/IMR/Data/Stockele data/Entire data.xlsx",
sheet = "Sheet3"); df3$tax_id <- c(1:nrow(df3));df3$m <- "Emu_2_order_&_Ost_2_high_order"
df4 <- read_excel("Library/CloudStorage/OneDrive-Havforskningsinstituttet/IMR/Data/Stockele data/Entire data.xlsx",
sheet = "Sheet4"); df4$tax_id <- c(1:nrow(df4));df4$m <- "Amp_eff_R";df4$seq_name <- paste0(">",df4$seq_name)
df5 <- read_excel("Library/CloudStorage/OneDrive-Havforskningsinstituttet/IMR/Data/Stockele data/Entire data.xlsx",
sheet = "Sheet5"); df5$tax_id <- c(1:nrow(df5));df5$m <- "Amp_eff_M"
seq_name<- c(df1$seq_name,df2$seq_name,df3$seq_name,df4$seq_name,df5$seq_name)
seq<- c(df1$seq,df2$seq,df3$seq,df4$seq,df5$seq)
m<- c(df1$m,df2$m,df3$m,df4$m,df5$m)
fast <- as.data.frame(cbind(seq_name,seq,m));rm(seq,seq_name,m)
fast$taxid <- c(1:nrow(fast))
#Change the name of the sequences for those who have identical nucleotide sequences
fast$seq_name[grep(">1.00_Silver_perch_Bardiella_chrysoura",
fast$seq_name)] <- ">1.00_Silver_perch_Bardiella_chrysoura"
fast$seq_name[grep(">1.00_Southern_kingfish_Menticirrhus_americanus",
fast$seq_name)] <- ">1.00_Southern_kingfish_Menticirrhus_americanus"
fast$seq_name[grep(">1.00_Northern_sennet_Sphyraena_borealis",
fast$seq_name)] <- ">1.00_Northern_sennet_Sphyraena_borealis"
fast$seq_name[grep(">1.00_Cutlassfis",
fast$seq_name)] <- ">1.00_Cutlassfish98_Trichiurus_sp98"
fast$seq_name[grep(">1.00_Crested_blenny_Hypleurochilus_",
fast$seq_name)] <- ">1.00_Crested_blenny_Hypleurochilus_germinatus"
fast$seq_name[grep(">3.01_Dog_Canis_lupus_",
fast$seq_name)] <- ">3.01_Dog_Canis_lupus"
fast$seq_name[grep(">3.01_Cat_Felis_catus",
fast$seq_name)] <- ">3.01_Cat_Felis_catus"
#Create a dataframe that looks at duplicated sequence names or duplicated nucleotide sequences
ident <- as.data.frame(cbind(duplicated(fast$seq_name),duplicated(fast$seq)))
ident$prod <- ident$V1+ident$V2; ident$prod[ident$prod==2] <- 0
ident <- as.data.frame(cbind(fast$seq_name[ident$prod>0],
fast$m[ident$prod>0],
ident$V1[ident$prod>0],
ident$V2[ident$prod>0]))
#Print the duplicated sequences which do not have the same sequence name
for (i in ident$V1[ident$V4==T]) {
l <- grep(i,fast$seq_name);ll <- fast$seq_name[grep(fast$seq[l],fast$seq)]
print(ll)}
#Create a database with unique tax_id for every unique taxa found in all the samples
db <- setNames(as.data.frame(cbind(unique(fast$seq_name))),"tax_name")
db$tax_id <- NA
for (i in 1:nrow(db))db$tax_id[i] <- min(fast$taxid[fast$seq_name%in%db$tax_name[i]])
#Create a dataframe that looks at similar sequence names or similar nucleotide sequences
rm(ident)
ident <- as.data.frame(matrix(NA,nrow(fast),10))
st <- 30;kmer <- 30
for (i in 1:nrow(fast))ident[i,1:length(fast$seq_name[grep(substr(fast$seq[i],st,st+kmer),fast$seq)])] <- fast$seq_name[grep(substr(fast$seq[i],st,st+kmer),fast$seq)]
#Identify and remove the taxa that is detected in only one of the runs
tax_alone_l <- is.na(ident$V2)
tax_alone <- ident$V1[is.na(ident$V2)]
ident <- ident[!tax_alone_l,]
#Identify and collapse the taxa that have identical sequence names
uu <- vector("character",length = nrow(ident))
uu
i=1
ll <- sum(!is.na(ident[i,]))
øø
ll
#Identify and collapse the taxa that have identical sequence names
uu <- vector("character",length = nrow(ident))
for (i in 1:nrow(ident)) {
ll <- sum(!is.na(ident[i,]))
if(sum(!duplicated(as.vector(ident[i,1:ll])))==1){
uu[i] <- as.character(ident[i,1:ll][!duplicated(as.vector(ident[i,1:ll]))])
}else{uu[i] <- NA}}
uu
#Create a dataframe that looks at similar sequence names or similar nucleotide sequences
rm(ident)
ident <- as.data.frame(matrix(NA,nrow(fast),10))
st <- 30;kmer <- 30
for (i in 1:nrow(fast))ident[i,1:length(fast$seq_name[grep(substr(fast$seq[i],st,st+kmer),fast$seq)])] <- fast$seq_name[grep(substr(fast$seq[i],st,st+kmer),fast$seq)]
View(ident)
i=
1
fast$seq_name[grep(substr(fast$seq[i],st,st+kmer),fast$seq)]
for (i in 1:nrow(fast)){
ll <- fast$seq_name[grep(substr(fast$seq[i],st,st+kmer),fast$seq)]
ident[i,1:length(ll)] <- ll}
#Identify and remove the taxa that is detected in only one of the runs
tax_alone_l <- is.na(ident$V2)
ident$V2
#Identify and remove the taxa that is detected in only one of the runs
tax_alone_l <- is.na(ident$V2)
tax_alone <- ident$V1[is.na(ident$V2)]
tax_alone
ident <- ident[!tax_alone_l,]
ident
#Identify and collapse the taxa that have identical sequence names
uu <- vector("character",length = nrow(ident))
for (i in 1:nrow(ident)) {
ll <- sum(!is.na(ident[i,]))
if(sum(!duplicated(as.vector(ident[i,1:ll])))==1){
uu[i] <- as.character(ident[i,1:ll][!duplicated(as.vector(ident[i,1:ll]))])
}else{uu[i] <- NA}}
ident <- ident[is.na(uu),]
ident[c(1,17),]
ident[c(2,19),]
i=2
ident[i,1:sum(!is.na(ident[i,]))]
i=3
ident[i,1:sum(!is.na(ident[i,]))]
i=4
ident[i,1:sum(!is.na(ident[i,]))]
i=5
ident[i,1:sum(!is.na(ident[i,]))]
i=6
ident[i,1:sum(!is.na(ident[i,]))]
grep("kingfish",uu)
uu[grep("kingfish",uu)]
i=7
ident[i,1:sum(!is.na(ident[i,]))]
i=8
ident[i,1:sum(!is.na(ident[i,]))]
i=9
ident[i,1:sum(!is.na(ident[i,]))]
i=10
ident[i,1:sum(!is.na(ident[i,]))]
i=11
ident[i,1:sum(!is.na(ident[i,]))]
i=12
ident[i,1:sum(!is.na(ident[i,]))]
i=13
ident[i,1:sum(!is.na(ident[i,]))]
i=14
ident[i,1:sum(!is.na(ident[i,]))]
i=15
ident[i,1:sum(!is.na(ident[i,]))]
i=16
ident[i,1:sum(!is.na(ident[i,]))]
i=17
ident[i,1:sum(!is.na(ident[i,]))]
i=18
ident[i,1:sum(!is.na(ident[i,]))]
i=18
cat("\n");cat(ident[i,1:sum(!is.na(ident[i,]))])
cat("\n");cat(ident[i,1:sum(!is.na(ident[i,]))])
cat("\n")
cat(ident[i,1:sum(!is.na(ident[i,]))])
cat("\n");print(ident[i,1:sum(!is.na(ident[i,]))])
cat("\n");print(ident[i,1:sum(!is.na(ident[i,]))])
p <- ">banded"
i=18
cat("\n");print(ident[i,1:sum(!is.na(ident[i,]))])
cat("\n");print(ident[i,1:sum(!is.na(ident[i,]))])
for (i in 1:56) {
cat("\n");cat("\n");print(ident[i,1:sum(!is.na(ident[i,]))])
}
temp <- NA;vector <- vector(length = nrow(multiple_sbj))
require("devtools");devtools::install_github("gledguri/ggednasd/ggu.base.fun");require("ggu.base.fun")
coll_sim2 <- function(db,sim){
l <- unique(sim); #l <- l[-1]
otu_coll <- data.frame(matrix(0, length(l), ncol(db)))
# tax_coll <- data.frame(matrix(0, length(l), ncol(tax)))
colnames(otu_coll) <- colnames(db);#colnames(tax_coll) <- colnames(tax)
rownames(otu_coll) <- l
for (i in 1:length(l)) {
otu_coll[i,] <- colSums(db[sim%in%l[i],])
}
return(otu_coll)
}
#Import the dataframes
# mmi <- read.csv("/Users/a36142/Library/CloudStorage/OneDrive-Havforskningsinstituttet/IMR/Data/Mock community/Premature Analaysis/Mock community input.csv")
mmi <- read.csv("/Users/a36142/Library/CloudStorage/OneDrive-Havforskningsinstituttet/IMR/Data/Mock community/Premature Analaysis/Mock community input_v2.csv")
mmi$X[2:3] <- paste0("--",mmi$X[2:3]) #Fix the names for the few species
rownames(mmi) <- mmi$X;mmi <- mmi[,!grepl("X",colnames(mmi))] #Move the species names from a column into rownames
mmi <- mmi[,-c(multi_grep(c("MC_v2_NC_Br1","MC_v1_NA_Br1"),colnames(mmi)))] #Remove the samples which the primers didn't work
mmi <- rel.ab(mmi) #Conver the input into relative abundances
mmo <- read.csv("/Users/a36142/Library/CloudStorage/OneDrive-Havforskningsinstituttet/IMR/Data/Mock community/Premature Analaysis/Mock community output.csv")
rownames(mmo) <- mmo$X;mmo <- mmo[,!grepl("X",colnames(mmo))]
mmo <- mmo[,-c(multi_grep(c("MC_v2_NC_Br1","MC_v1_NA_Br1"),colnames(mmo)))]
source("~/Library/CloudStorage/OneDrive-Havforskningsinstituttet/IMR/Data/Mock community/Premature Analaysis/Amplification efficiency (premature)_Jan23.R", echo=TRUE)
require("devtools");devtools::install_github("gledguri/ggednasd/ggu.base.fun");require("ggu.base.fun")
coll_sim2 <- function(db,sim){
l <- unique(sim); #l <- l[-1]
otu_coll <- data.frame(matrix(0, length(l), ncol(db)))
# tax_coll <- data.frame(matrix(0, length(l), ncol(tax)))
colnames(otu_coll) <- colnames(db);#colnames(tax_coll) <- colnames(tax)
rownames(otu_coll) <- l
for (i in 1:length(l)) {
otu_coll[i,] <- colSums(db[sim%in%l[i],])
}
return(otu_coll)
}
#Import the dataframes
# mmi <- read.csv("/Users/a36142/Library/CloudStorage/OneDrive-Havforskningsinstituttet/IMR/Data/Mock community/Premature Analaysis/Mock community input.csv")
mmi <- read.csv("/Users/a36142/Library/CloudStorage/OneDrive-Havforskningsinstituttet/IMR/Data/Mock community/Premature Analaysis/Mock community input_v2.csv")
mmi$X[2:3] <- paste0("--",mmi$X[2:3]) #Fix the names for the few species
rownames(mmi) <- mmi$X;mmi <- mmi[,!grepl("X",colnames(mmi))] #Move the species names from a column into rownames
mmi <- mmi[,-c(multi_grep(c("MC_v2_NC_Br1","MC_v1_NA_Br1"),colnames(mmi)))] #Remove the samples which the primers didn't work
mmi <- rel.ab(mmi) #Conver the input into relative abundances
mmo <- read.csv("/Users/a36142/Library/CloudStorage/OneDrive-Havforskningsinstituttet/IMR/Data/Mock community/Premature Analaysis/Mock community output.csv")
rownames(mmo) <- mmo$X;mmo <- mmo[,!grepl("X",colnames(mmo))]
mmo <- mmo[,-c(multi_grep(c("MC_v2_NC_Br1","MC_v1_NA_Br1"),colnames(mmo)))]
#Collapse the somewhat similar rows
#Create the vector that contains similar species names
spname <- rownames(mmi)
spname[4:6] <- c("Cyprinidae-Trigonostigma-Trigonostigma espei")
spname[7:8] <- "Poeciliidae-Poecilia-Poecilia spp."
spname[13:14] <- "Cyclopteridae-Cyclopterus-Cyclopterus lumpus"
spname[17:18] <- "Pleuronectidae--"
#Collapse the somewhat similar rows
mmi <- coll_sim2(mmi,spname)
mmo <- coll_sim2(mmo,spname)
l <- rowSums(mmi)>0 #Remove species that rowSums are 0
mmi <- mmi[l,];mmo <- mmo[l,]
mmo[mmo<0.5] <- 0 #Round down the low abundances for simplicity
#Create the contrast/amplification dataframe
cont <- mmo/mmi
#Remove the Inf and NaNs
for (i in 1:nrow(cont)) {
cont[i,grep("Inf",cont[i,])] <- 0
}
for (i in 1:nrow(cont)) {
cont[i,grep("NaN",cont[i,])] <- 0
}
#Summarise the amplification efficiency dataframe
amp.eff <- cbind(rowMeans(cont[,c("MC_amplicon_NB_1", "MC_amplicon_NB_2")]),rowMeans(cont[,c("MC_v1_NA_Br2", "MC_v1_NA_Br3")]),
rowMeans(cont[,c("MC_v2_NB_Br1", "MC_v2_NB_Br2","MC_v2_NC_Br2")]),rowMeans(cont[,c("MC_v3_ND_Br1", "MC_v3_ND_Br2","MC_v3_ND_Br3")]))
colnames(amp.eff) <- c("MC_Amplicon","MC1","MC2","MC3")
#Remove the first species
amp.eff <- amp.eff[-1,]
#Rename species names
rownames(amp.eff) <- c("M.muelleri","T.espei","P.sphenops","G.morhua","B.brosme","M.villosus",
"M.scorpius","C.lumpus","P.gunnellus","L.maculatus","Pleuronectidae")
amp.eff.t <- trans(as.data.frame(amp.eff))
colnames(amp.eff.t) <- c("Species","Sample","Amp_eff")
# {pdf("/Users/a36142/Library/CloudStorage/OneDrive-Havforskningsinstituttet/IMR/Data/Mock community/Premature Analaysis/Roughly estimated amplification.pdf",width = 18.75,height = 18.75)
ggplot(amp.eff.t, aes(fill=Species, y=Amp_eff, x=Sample)) +
geom_bar(position="stack", stat="identity")+
ggtitle("Roughly estimated amplification efficiency of species in Mock communities")
library("ggplot")
library("ggplot2")
# {pdf("/Users/a36142/Library/CloudStorage/OneDrive-Havforskningsinstituttet/IMR/Data/Mock community/Premature Analaysis/Roughly estimated amplification.pdf",width = 18.75,height = 18.75)
ggplot(amp.eff.t, aes(fill=Species, y=Amp_eff, x=Sample)) +
geom_bar(position="stack", stat="identity")+
ggtitle("Roughly estimated amplification efficiency of species in Mock communities")
#Summarise the mock community output dataframe
mmo_s <- cbind(rowMeans(mmo[,c("MC_amplicon_NB_1", "MC_amplicon_NB_2")]),rowMeans(mmo[,c("MC_v1_NA_Br2", "MC_v1_NA_Br3")]),
rowMeans(mmo[,c("MC_v2_NB_Br1", "MC_v2_NB_Br2","MC_v2_NC_Br2")]),rowMeans(mmo[,c("MC_v3_ND_Br1", "MC_v3_ND_Br2","MC_v3_ND_Br3")]))
colnames(mmo_s) <- c("MC_Amplicon","MC1","MC2","MC3")
mmo_s <- mmo_s[-1,]
rownames(mmo_s) <- c("M.muelleri","T.espei","P.sphenops","G.morhua","B.brosme","M.villosus",
"M.scorpius","C.lumpus","P.gunnellus","L.maculatus","Pleuronectidae")
mmo_s.t <- trans(as.data.frame(mmo_s))
colnames(mmo_s.t) <- c("Species","Sample","Relative_abundance")
ggplot(mmo_s.t, aes(fill=Species, y=Relative_abundance, x=Sample)) +
geom_bar(position="stack", stat="identity")+
ggtitle("Relative abundances of species in  Mock communities")
mmo_s.t
dim(mmo_s.t)
dim(mmi_s.t)
dim(amp.eff.t)
amp.eff.t
mmo_s.t
cbind(mmo_s.t,amp.eff.t)
require("devtools");devtools::install_github("gledguri/ggednasd/ggu.base.fun");require("ggu.base.fun")
library("ggplot2")
coll_sim2 <- function(db,sim){
l <- unique(sim); #l <- l[-1]
otu_coll <- data.frame(matrix(0, length(l), ncol(db)))
# tax_coll <- data.frame(matrix(0, length(l), ncol(tax)))
colnames(otu_coll) <- colnames(db);#colnames(tax_coll) <- colnames(tax)
rownames(otu_coll) <- l
for (i in 1:length(l)) {
otu_coll[i,] <- colSums(db[sim%in%l[i],])
}
return(otu_coll)
}
#Import the dataframes
# mmi <- read.csv("/Users/a36142/Library/CloudStorage/OneDrive-Havforskningsinstituttet/IMR/Data/Mock community/Premature Analaysis/Mock community input.csv")
mmi <- read.csv("/Users/a36142/Library/CloudStorage/OneDrive-Havforskningsinstituttet/IMR/Data/Mock community/Premature Analaysis/Mock community input_v2.csv")
mmi$X[2:3] <- paste0("--",mmi$X[2:3]) #Fix the names for the few species
rownames(mmi) <- mmi$X;mmi <- mmi[,!grepl("X",colnames(mmi))] #Move the species names from a column into rownames
mmi <- mmi[,-c(multi_grep(c("MC_v2_NC_Br1","MC_v1_NA_Br1"),colnames(mmi)))] #Remove the samples which the primers didn't work
mmi <- rel.ab(mmi) #Conver the input into relative abundances
mmo <- read.csv("/Users/a36142/Library/CloudStorage/OneDrive-Havforskningsinstituttet/IMR/Data/Mock community/Premature Analaysis/Mock community output.csv")
rownames(mmo) <- mmo$X;mmo <- mmo[,!grepl("X",colnames(mmo))]
mmo <- mmo[,-c(multi_grep(c("MC_v2_NC_Br1","MC_v1_NA_Br1"),colnames(mmo)))]
#Collapse the somewhat similar rows
#Create the vector that contains similar species names
spname <- rownames(mmi)
spname[4:6] <- c("Cyprinidae-Trigonostigma-Trigonostigma espei")
spname[7:8] <- "Poeciliidae-Poecilia-Poecilia spp."
spname[13:14] <- "Cyclopteridae-Cyclopterus-Cyclopterus lumpus"
spname[17:18] <- "Pleuronectidae--"
#Collapse the somewhat similar rows
mmi <- coll_sim2(mmi,spname)
mmo <- coll_sim2(mmo,spname)
l <- rowSums(mmi)>0 #Remove species that rowSums are 0
mmi <- mmi[l,];mmo <- mmo[l,]
mmo[mmo<0.5] <- 0 #Round down the low abundances for simplicity
#Summarise the mock community output dataframe
mmo_s <- cbind(rowMeans(mmo[,c("MC_amplicon_NB_1", "MC_amplicon_NB_2")]),rowMeans(mmo[,c("MC_v1_NA_Br2", "MC_v1_NA_Br3")]),
#Summarise the mock community output dataframe
mmo_s <- cbind(rowMeans(mmo[,c("MC_amplicon_NB_1", "MC_amplicon_NB_2")]),rowMeans(mmo[,c("MC_v1_NA_Br2", "MC_v1_NA_Br3")]),
mmo_s <- cbind(rowMeans(mmo[,c("MC_amplicon_NB_1", "MC_amplicon_NB_2")]),rowMeans(mmo[,c("MC_v1_NA_Br2", "MC_v1_NA_Br3")]),
rowMeans(mmo[,c("MC_v2_NB_Br1", "MC_v2_NB_Br2","MC_v2_NC_Br2")]),rowMeans(mmo[,c("MC_v3_ND_Br1", "MC_v3_ND_Br2","MC_v3_ND_Br3")]))
colnames(mmo_s) <- c("MC_Amplicon","MC1","MC2","MC3")
mmo_s <- mmo_s[-1,]
rownames(mmo_s) <- c("M.muelleri","T.espei","P.sphenops","G.morhua","B.brosme","M.villosus",
"M.scorpius","C.lumpus","P.gunnellus","L.maculatus","Pleuronectidae")
mmo_s
#Summarise the mock community input dataframe
mmi_s <- cbind(rowMeans(mmi[,c("MC_amplicon_NB_1", "MC_amplicon_NB_2")]),rowMeans(mmi[,c("MC_v1_NA_Br2", "MC_v1_NA_Br3")]),
rowMeans(mmi[,c("MC_v2_NB_Br1", "MC_v2_NB_Br2","MC_v2_NC_Br2")]),rowMeans(mmi[,c("MC_v3_ND_Br1", "MC_v3_ND_Br2","MC_v3_ND_Br3")]))
colnames(mmi_s) <- c("MC_Amplicon","MC1","MC2","MC3")
mmo_s <- mmi_s[-1,]
rownames(mmi_s) <- c("M.muelleri","T.espei","P.sphenops","G.morhua","B.brosme","M.villosus",
"M.scorpius","C.lumpus","P.gunnellus","L.maculatus","Pleuronectidae")
mmi_s
#Summarise the mock community input dataframe
mmi_s <- cbind(rowMeans(mmi[,c("MC_amplicon_NB_1", "MC_amplicon_NB_2")]),rowMeans(mmi[,c("MC_v1_NA_Br2", "MC_v1_NA_Br3")]),
rowMeans(mmi[,c("MC_v2_NB_Br1", "MC_v2_NB_Br2","MC_v2_NC_Br2")]),rowMeans(mmi[,c("MC_v3_ND_Br1", "MC_v3_ND_Br2","MC_v3_ND_Br3")]))
colnames(mmi_s) <- c("MC_Amplicon","MC1","MC2","MC3")
mmi_s
dim(mmi_s)
rownames(mmi_s) <- c("C.harrengus","M.muelleri","T.espei","P.sphenops","G.morhua","B.brosme","M.villosus",
"M.scorpius","C.lumpus","P.gunnellus","L.maculatus","Pleuronectidae")
mmi_s
mmo_s.t <- trans(as.data.frame(mmo_s))
mmi_s.t <- trans(as.data.frame(mmi_s))
mmi_s.t
plotdb <- rbind(trans(as.data.frame(mmo_s)),trans(as.data.frame(mmi_s)))
plotdb
#Summarise the mock community output dataframe
mmo_s <- cbind(rowMeans(mmo[,c("MC_amplicon_NB_1", "MC_amplicon_NB_2")]),rowMeans(mmo[,c("MC_v1_NA_Br2", "MC_v1_NA_Br3")]),
colnames(mmo_s) <- c("MC_Amplicon","MC1","MC2","MC3")
mmo_s <- mmo_s[-1,]
rownames(mmo_s) <- c("M.muelleri","T.espei","P.sphenops","G.morhua","B.brosme","M.villosus",
"M.scorpius","C.lumpus","P.gunnellus","L.maculatus","Pleuronectidae")
#Summarise the mock community input dataframe
mmi_s <- cbind(rowMeans(mmi[,c("MC_amplicon_NB_1", "MC_amplicon_NB_2")]),rowMeans(mmi[,c("MC_v1_NA_Br2", "MC_v1_NA_Br3")]),
rowMeans(mmi[,c("MC_v2_NB_Br1", "MC_v2_NB_Br2","MC_v2_NC_Br2")]),rowMeans(mmi[,c("MC_v3_ND_Br1", "MC_v3_ND_Br2","MC_v3_ND_Br3")]))
colnames(mmi_s) <- c("MC_Amplicon","MC1","MC2","MC3")
rownames(mmi_s) <- c("C.harrengus","M.muelleri","T.espei","P.sphenops","G.morhua","B.brosme","M.villosus",
"M.scorpius","C.lumpus","P.gunnellus","L.maculatus","Pleuronectidae")
#Summarise the mock community output dataframe
mmo_s <- cbind(rowMeans(mmo[,c("MC_amplicon_NB_1", "MC_amplicon_NB_2")]),rowMeans(mmo[,c("MC_v1_NA_Br2", "MC_v1_NA_Br3")]),
colnames(mmo_s) <- c("MC_Amplicon","MC1","MC2","MC3")
mmo_s <- mmo_s[-1,]
mmo_s
#Summarise the mock community output dataframe
mmo_s <- cbind(rowMeans(mmo[,c("MC_amplicon_NB_1", "MC_amplicon_NB_2")]),rowMeans(mmo[,c("MC_v1_NA_Br2", "MC_v1_NA_Br3")]),
mmo_s
#Summarise the mock community output dataframe
mmo_s <- cbind(rowMeans(mmo[,c("MC_amplicon_NB_1", "MC_amplicon_NB_2")]),rowMeans(mmo[,c("MC_v1_NA_Br2", "MC_v1_NA_Br3")]),
#Summarise the mock community output dataframe
mmo_s <- cbind(rowMeans(mmo[,c("MC_amplicon_NB_1", "MC_amplicon_NB_2")]),rowMeans(mmo[,c("MC_v1_NA_Br2", "MC_v1_NA_Br3")]),rowMeans(mmo[,c("MC_v2_NB_Br1", "MC_v2_NB_Br2","MC_v2_NC_Br2")]),rowMeans(mmo[,c("MC_v3_ND_Br1", "MC_v3_ND_Br2","MC_v3_ND_Br3")]))
#Summarise the mock community output dataframe
mmo_s <- cbind(rowMeans(mmo[,c("MC_amplicon_NB_1", "MC_amplicon_NB_2")]),rowMeans(mmo[,c("MC_v1_NA_Br2", "MC_v1_NA_Br3")]),rowMeans(mmo[,c("MC_v2_NB_Br1", "MC_v2_NB_Br2","MC_v2_NC_Br2")]),rowMeans(mmo[,c("MC_v3_ND_Br1", "MC_v3_ND_Br2","MC_v3_ND_Br3")]))
#Summarise the mock community output dataframe
mmo_s <- cbind(rowMeans(mmo[,c("MC_amplicon_NB_1", "MC_amplicon_NB_2")]),rowMeans(mmo[,c("MC_v1_NA_Br2", "MC_v1_NA_Br3")]),rowMeans(mmo[,c("MC_v2_NB_Br1", "MC_v2_NB_Br2","MC_v2_NC_Br2")]),rowMeans(mmo[,c("MC_v3_ND_Br1", "MC_v3_ND_Br2","MC_v3_ND_Br3")]))
colnames(mmo_s) <- c("MC_Amplicon","MC1","MC2","MC3")
#Summarise the mock community output dataframe
mmo_s <- cbind(rowMeans(mmo[,c("MC_amplicon_NB_1", "MC_amplicon_NB_2")]),rowMeans(mmo[,c("MC_v1_NA_Br2", "MC_v1_NA_Br3")]),rowMeans(mmo[,c("MC_v2_NB_Br1", "MC_v2_NB_Br2","MC_v2_NC_Br2")]),rowMeans(mmo[,c("MC_v3_ND_Br1", "MC_v3_ND_Br2","MC_v3_ND_Br3")]))
colnames(mmo_s) <- c("MC_Amplicon","MC1","MC2","MC3")
#Summarise the mock community output dataframe
mmo_s <- cbind(rowMeans(mmo[,c("MC_amplicon_NB_1", "MC_amplicon_NB_2")]),rowMeans(mmo[,c("MC_v1_NA_Br2", "MC_v1_NA_Br3")]),rowMeans(mmo[,c("MC_v2_NB_Br1", "MC_v2_NB_Br2","MC_v2_NC_Br2")]),rowMeans(mmo[,c("MC_v3_ND_Br1", "MC_v3_ND_Br2","MC_v3_ND_Br3")]))
colnames(mmo_s) <- c("MC_Amplicon","MC1","MC2","MC3")
#Summarise the mock community output dataframe
mmo_s <- cbind(rowMeans(mmo[,c("MC_amplicon_NB_1", "MC_amplicon_NB_2")]),rowMeans(mmo[,c("MC_v1_NA_Br2", "MC_v1_NA_Br3")]),rowMeans(mmo[,c("MC_v2_NB_Br1", "MC_v2_NB_Br2","MC_v2_NC_Br2")]),rowMeans(mmo[,c("MC_v3_ND_Br1", "MC_v3_ND_Br2","MC_v3_ND_Br3")]));
require("devtools");devtools::install_github("gledguri/ggednasd/ggu.base.fun");require("ggu.base.fun")
library("ggplot2")
coll_sim2 <- function(db,sim){
l <- unique(sim); #l <- l[-1]
otu_coll <- data.frame(matrix(0, length(l), ncol(db)))
# tax_coll <- data.frame(matrix(0, length(l), ncol(tax)))
colnames(otu_coll) <- colnames(db);#colnames(tax_coll) <- colnames(tax)
rownames(otu_coll) <- l
for (i in 1:length(l)) {
otu_coll[i,] <- colSums(db[sim%in%l[i],])
}
return(otu_coll)
}
#Import the dataframes
# mmi <- read.csv("/Users/a36142/Library/CloudStorage/OneDrive-Havforskningsinstituttet/IMR/Data/Mock community/Premature Analaysis/Mock community input.csv")
mmi <- read.csv("/Users/a36142/Library/CloudStorage/OneDrive-Havforskningsinstituttet/IMR/Data/Mock community/Premature Analaysis/Mock community input_v2.csv")
mmi$X[2:3] <- paste0("--",mmi$X[2:3]) #Fix the names for the few species
rownames(mmi) <- mmi$X;mmi <- mmi[,!grepl("X",colnames(mmi))] #Move the species names from a column into rownames
mmi <- mmi[,-c(multi_grep(c("MC_v2_NC_Br1","MC_v1_NA_Br1"),colnames(mmi)))] #Remove the samples which the primers didn't work
mmi <- rel.ab(mmi) #Conver the input into relative abundances
mmo <- read.csv("/Users/a36142/Library/CloudStorage/OneDrive-Havforskningsinstituttet/IMR/Data/Mock community/Premature Analaysis/Mock community output.csv")
rownames(mmo) <- mmo$X;mmo <- mmo[,!grepl("X",colnames(mmo))]
mmo <- mmo[,-c(multi_grep(c("MC_v2_NC_Br1","MC_v1_NA_Br1"),colnames(mmo)))]
#Collapse the somewhat similar rows
#Create the vector that contains similar species names
spname <- rownames(mmi)
spname[4:6] <- c("Cyprinidae-Trigonostigma-Trigonostigma espei")
spname[7:8] <- "Poeciliidae-Poecilia-Poecilia spp."
spname[13:14] <- "Cyclopteridae-Cyclopterus-Cyclopterus lumpus"
spname[17:18] <- "Pleuronectidae--"
#Collapse the somewhat similar rows
mmi <- coll_sim2(mmi,spname)
mmo <- coll_sim2(mmo,spname)
l <- rowSums(mmi)>0 #Remove species that rowSums are 0
mmi <- mmi[l,];mmo <- mmo[l,]
mmo[mmo<0.5] <- 0 #Round down the low abundances for simplicity
#' #'*Create the contrast/amplification dataframe*
#' #You can turn it off if you don't want to focus on amplification efficiency
#' cont <- mmo/mmi
#'
#' #Remove the Inf and NaNs
#' for (i in 1:nrow(cont)) {
#'   cont[i,grep("Inf",cont[i,])] <- 0
#' }
#' for (i in 1:nrow(cont)) {
#'   cont[i,grep("NaN",cont[i,])] <- 0
#' }
#'
#' #Summarise the amplification efficiency dataframe
#' amp.eff <- cbind(rowMeans(cont[,c("MC_amplicon_NB_1", "MC_amplicon_NB_2")]),rowMeans(cont[,c("MC_v1_NA_Br2", "MC_v1_NA_Br3")]),
#'                  rowMeans(cont[,c("MC_v2_NB_Br1", "MC_v2_NB_Br2","MC_v2_NC_Br2")]),rowMeans(cont[,c("MC_v3_ND_Br1", "MC_v3_ND_Br2","MC_v3_ND_Br3")]))
#' colnames(amp.eff) <- c("MC_Amplicon","MC1","MC2","MC3")
#'
#' #Remove the first species
#' amp.eff <- amp.eff[-1,]
#'
#' #Rename species names
#' rownames(amp.eff) <- c("M.muelleri","T.espei","P.sphenops","G.morhua","B.brosme","M.villosus",
#'                        "M.scorpius","C.lumpus","P.gunnellus","L.maculatus","Pleuronectidae")
#'
#' amp.eff.t <- trans(as.data.frame(amp.eff))
#' colnames(amp.eff.t) <- c("Species","Sample","Amp_eff")
#'
#' # {pdf("/Users/a36142/Library/CloudStorage/OneDrive-Havforskningsinstituttet/IMR/Data/Mock community/Premature Analaysis/Roughly estimated amplification.pdf",width = 18.75,height = 18.75)
#' ggplot(amp.eff.t, aes(fill=Species, y=Amp_eff, x=Sample)) +
#'   geom_bar(position="stack", stat="identity")+
#'   ggtitle("Roughly estimated amplification efficiency of species in Mock communities")
#'   # dev.off()}
#' # ggsave("/Users/a36142/Library/CloudStorage/OneDrive-Havforskningsinstituttet/IMR/Data/Mock community/Premature Analaysis/Roughly estimated amplification.pdf",
#'        # width = 18.75, height = 18.75,units = "cm")
#Summarise the mock community output dataframe
mmo_s <- cbind(rowMeans(mmo[,c("MC_amplicon_NB_1", "MC_amplicon_NB_2")]),rowMeans(mmo[,c("MC_v1_NA_Br2", "MC_v1_NA_Br3")]),rowMeans(mmo[,c("MC_v2_NB_Br1", "MC_v2_NB_Br2","MC_v2_NC_Br2")]),rowMeans(mmo[,c("MC_v3_ND_Br1", "MC_v3_ND_Br2","MC_v3_ND_Br3")]));
mmo_s
rm(mmo_s)
#Summarise the mock community output dataframe
mmo_s <- cbind(rowMeans(mmo[,c("MC_amplicon_NB_1", "MC_amplicon_NB_2")]),
rowMeans(mmo[,c("MC_v2_NB_Br1", "MC_v2_NB_Br2","MC_v2_NC_Br2")]),
#DNA analysis
# Instal libraries --------------------------------------------------------
library(devtools)
library(vegan)
library(ggu.base.fun)
library(ggplot2)
library(easycsv)
library(RColorBrewer)
library(labdsv)
library(GMCM)
# install_github("gledguri/ggednasd/ggu.base.fun")
# install_github("pmartinezarbizu/pairwiseAdonis/pairwiseAdonis")
library(pairwiseAdonis)
#pairwise.adonis2(dist ~ , data=mm,p.adjust.m = "BY")
devtools::session_info()
library(ggu.base.fun)
?write.result
?seq_dev()
library(devtools)
devtools::install_github("gledguri/ggednasd/ggu.base.fun")
setwd("/Users/a36142/Documents/GitHub/ggednasd/ggu.base.fun")
devtools::load_all()
?devtools::load_all()
devtools::load_all()
library(devtools)
devtools::install_github("gledguri/ggednasd/ggu.base.fun")
setwd("/Users/a36142/Documents/GitHub/ggednasd/ggu.base.fun")
devtools::load_all()
?logit
logit(4)
logit(1)
logit(0.99)
inverselogit(5)
